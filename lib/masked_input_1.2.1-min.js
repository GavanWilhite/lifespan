(function(a){a.MaskedInput=function(d){if(!d||!d.elm||!d.format){return null}if(!(this instanceof a.MaskedInput)){return new a.MaskedInput(d)}var k=this,c=d.elm,o=d.format,f=d.allowed||"0123456789",l=d.separator||"/:-",j=d.typeon||"_YMDhms",b=d.onbadkey||function(){},t=d.badkeywait||0,u=false,p=o;var i=function(z,x,y,w){if(window.addEventListener){return function(D,B,C,A){D.addEventListener(B,C,(A===undefined)?false:A)}}if(window.attachEvent){return function(C,A,B){C.attachEvent("on"+A,B)}}return function(C,A,B){C["on"+A]=B}}();var n=function(){if(!c.tagName||(c.tagName.toUpperCase()!=="INPUT"&&c.tagName.toUpperCase()!=="TEXTAREA")){return null}c.value=o;i(c,"keydown",function(w){s(w)});i(c,"keypress",function(w){e(w)});i(c,"focus",function(){p=c.value});i(c,"blur",function(){if(c.value!==p&&c.onchange){c.onchange()}});return k};var v=function(y){y=y||window.event;var x="",z=y.which,w=y.type;if(z==null){z=y.keyCode}if(z===null){return""}switch(z){case 8:x="bksp";break;case 46:x=(w=="keydown")?"del":".";break;case 16:x="shift";break;case 0:case 9:case 13:x="etc";break;case 37:case 38:case 39:case 40:x=(!y.shiftKey&&(y.charCode!=39&&y.charCode!==undefined))?"etc":String.fromCharCode(z);break;default:x=String.fromCharCode(z)}return x};var q=function(w,x){if(w.preventDefault){w.preventDefault()}w.returnValue=x||false};var s=function(x){x=x||event;if(u){q(x);return false}var w=v(x);if((x.metaKey||x.ctrlKey)&&(w=="X"||w=="V")){q(x);return false}if(x.metaKey||x.ctrlKey){return true}if(c.value==""){c.value=o;r(c,0)}if(w=="bksp"||w=="del"){h(w);q(x);return false}else{return true}};var e=function(x){x=x||event;if(u){q(x);return false}var w=v(x);if(w=="etc"||x.metaKey||x.ctrlKey||x.altKey){return true}if(w!="bksp"&&w!="del"&&w!="shift"){if(!m(w)){q(x);return false}if(h(w)){q(x,true);return true}q(x);return false}else{return false}};var h=function(w){var x=g(c),z=c.value,y="";switch(true){case (f.indexOf(w)!=-1):if(++x>o.length){return false}while(l.indexOf(z.charAt(x-1))!=-1&&x<=o.length){x++}y=z.substr(0,x-1)+w+z.substr(x);if(f.indexOf(z.charAt(x))==-1&&j.indexOf(z.charAt(x))==-1){x++}break;case (w=="bksp"):if(--x<0){return false}while(f.indexOf(z.charAt(x))==-1&&j.indexOf(z.charAt(x))==-1&&x>1){x--}y=z.substr(0,x)+o.substr(x,1)+z.substr(x+1);break;case (w=="del"):if(x>=z.length){return false}while(l.indexOf(z.charAt(x))!=-1&&z.charAt(x)!=""){x++}y=z.substr(0,x)+o.substr(x,1)+z.substr(x+1);x++;break;case (w=="etc"):return true;default:return false}c.value="";c.value=y;r(c,x);return false};var g=function(y){try{if(y.selectionStart>=0){return y.selectionStart}else{if(document.selection){var w=y.value;var x=document.selection.createRange();x.text="|%|";var A=y.value.indexOf("|%|");x.moveStart("character",-3);x.text="";y.value=w;return A}}return -1}catch(z){return -1}};var r=function(x,z){try{if(x.selectionStart){x.focus();x.setSelectionRange(z,z)}else{if(x.createTextRange){var w=x.createTextRange();w.move("character",z);w.select()}}}catch(y){return false}return true};var m=function(w){if(f.indexOf(w)==-1&&w!="bksp"&&w!="del"&&w!="etc"){var x=g(c);u=true;b();setTimeout(function(){u=false;r(c,x)},t);return false}return true};k.resetField=function(){c.value=o};k.setAllowed=function(w){f=w;resetField()};k.setFormat=function(w){o=w;resetField()};k.setSeparator=function(w){l=w;resetField()};k.setTypeon=function(w){j=w;resetField()};return n()}})(window);